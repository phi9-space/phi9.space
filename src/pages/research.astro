---
import BaseLayout from '@layouts/BaseLayout.astro';
import MarkdownRenderer from '@components/MarkdownRenderer.astro';
import LatestFeed from '@components/LatestFeed.astro';
import { getEntry, getCollection } from 'astro:content';

const research = await getEntry('pages', 'research');
const { Content, headings } = await research.render();
const blogPosts = await getCollection('blog', (entry) => !entry.data.draft && entry.data.tags.includes('research'));
---
<BaseLayout
  title={`${research.data.title} â€” phi9.space`}
  description={research.data.description}
  pageType="article"
>
  <section slot="left" class="page-sidebar glass-panel">
    <p class="page-sidebar__eyebrow">research</p>
    <h2 class="page-sidebar__title">{research.data.title}</h2>
    {research.data.heroSubtitle && <p class="page-sidebar__subtitle">{research.data.heroSubtitle}</p>}
    {research.data.updated && (
      <p class="page-sidebar__meta">Updated {research.data.updated.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</p>
    )}
  </section>

  <header class="page-hero">
    <p class="page-hero__eyebrow">research</p>
    <h1>{research.data.title}</h1>
    {research.data.heroSubtitle && <p class="page-hero__subtitle">{research.data.heroSubtitle}</p>}
    {research.data.updated && (
      <p class="page-hero__meta">Updated {research.data.updated.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</p>
    )}
  </header>

  <MarkdownRenderer Content={Content} raw={research.body} headings={headings} />

  <LatestFeed posts={blogPosts} title="Tagged: research" />
</BaseLayout>

<style>
  .page-hero {
    display: grid;
    gap: 0.75rem;
    margin-bottom: 2.5rem;
  }

  .page-hero__eyebrow {
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.3em;
    font-size: 0.75rem;
    color: rgba(32, 32, 32, 0.55);
  }

  .page-hero h1 {
    margin: 0;
    font-size: clamp(2.6rem, 5vw, 3.4rem);
  }

  .page-hero__subtitle {
    margin: 0;
    color: rgba(32, 32, 32, 0.68);
    max-width: 60ch;
  }

  .page-hero__meta {
    margin: 0;
    font-size: 0.85rem;
    color: rgba(32, 32, 32, 0.6);
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  .page-sidebar {
    display: grid;
    gap: 0.75rem;
    padding: clamp(1.25rem, 2vw, 1.75rem);
  }

  .page-sidebar__eyebrow {
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.3em;
    font-size: 0.7rem;
    color: rgba(32, 32, 32, 0.6);
  }

  .page-sidebar__title {
    margin: 0;
    font-size: clamp(1.6rem, 2.4vw, 1.9rem);
  }

  .page-sidebar__subtitle {
    margin: 0;
    color: rgba(32, 32, 32, 0.7);
  }

  .page-sidebar__meta {
    margin: 0;
    font-size: 0.85rem;
    color: rgba(32, 32, 32, 0.55);
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }
</style>
